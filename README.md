[![Build Status](https://travis-ci.org/DavidPeicho/artflow.svg?branch=master)](https://travis-ci.org/DavidPeicho/artflow)

# Artflow

**ArtFlow** is a frontend VR 3D software, in which you can draw your own world using VR controllers.

**ArtFlow** is greatly influenced by [Tilt Brush](https://www.tiltbrush.com/), and [A-Painter](https://github.com/aframevr/a-painter).

[![ArtFlow Video](https://user-images.githubusercontent.com/8783766/31792707-36e8d1b2-b51d-11e7-9dfc-9b411258deb0.png)
](https://youtu.be/QyUaBjSxGXc)

## Local Execution

### Dependencies
In order to use the application locally, you need to have a relatively new version of [Yarn](https://yarnpkg.com/lang/en/) or [npm](https://www.npmjs.com/) installed on your system.

### Build
You can build the application by using the following npm command:
```sh
$ cd path/to/artflow
$ yarn run build
```
The output generated by [Webpack](https://webpack.github.io/) is located in the *build/* folder.

## Development Environment
If you want to modify the application, you can use the development environment we created.
You first have to launch the development server, by running:
```sh
$ cd path/to/artflow
$ yarn run dev
```

The [webpack-dev-server](https://webpack.github.io/docs/webpack-dev-server.html) will watch for changes and you can directly modify the code.

## Integrate you own code

In order for you to dive easily into the existing code, you can see below a draft of how the code flows in the application:
<p align="center">
  <img width="700" src="https://user-images.githubusercontent.com/8783766/29539020-85b4697e-86c8-11e7-91b2-bd6279604627.png">
</p>

### Create my own tool

#### Extending the AbstractTool
You first need to create a tool extending the `AbstractTool` prototype. You have to implement every method you need (such as `update()` for instance), and the tool will be instanciated later.
One thing you have to notice, in our design, the tool instance takes care of the data it adds in the Three.js scene-graph. We did this on purpose, in order to let you have a huge control when creating a tool.
You can create meshes, spline, etc that you can add to two Three.js `Group`. You can add your data either by doing:
```javascript
this.localGroup.addTHREEObject(myObject);
```
or
```javascript
this.worldGroup.addTHREEObject(myObject);
```
The first is used to add objects that will be in the VR room-scale frame. So, basically, if you want to make an object follow the controllers, you will add it to this group.
The second is a bit more complex. Whenever you move by using the keyboard, or the teleportation, everything inside the worldGroup will be offseted. So, basically, you want to add everything that should have a world position in `worlsGroup`. For instance, the brush shapes, the water planes are all added to the `worldGroup`.

### Registering your tool

Next step is to register your tool, by calling the `ToolModule` static method `register()`.
You can register a tool as follow:
```javascript
let Artflow = require('./artflow.js');
let ToolModule = Artflow.modules.ToolModule;

let toolDescription = {
  image: [path_to_image],
  tool: [your_tool_constructor],
  options: [tools_options]
};

ToolModule.register('MyNiceTool', toolDescription);
```

## Three.js Code Reuse

**ArtFlow** is built upon a [Model-view-controller](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller), where views are Three.js *Object3D*, or our custom wrapper over Three.js *Object3D*. Basically, you can reuse every controller in your Three.js projects, such as the teleporter, or the brush, by changing only one or two lines of code.

### TODO

#### All
* [ ] Use pow2 textures. It would be nice to reduce the number of requests, by merging textures together and using different UVs (for instance for the UI).
* [ ] Add the shake events
* [ ] Add tool to take screenshot
* [ ] Add small tutorial showing how to open menu, how to draw, etc...
* [X] Add icon above controler showing which tool is selected
* [X] Add cubemap selection

#### Brushes
* [ ] Fix stroke not working when we do not change the size of the brush
* [ ] Use color in when possible, even if the stroke is dynamic.
* [ ] Fix missing stroke in UI (wrongly registered)
* [X] Remove hardcoded strokes from AbstractBrushTool
* [X] Remove call to ToolModule from BrushHelper. (The dependecy should come from the UI, or somewhere else).
* [X] Add pressure
* [X] Move BrushHelper to BrushTool instead of AbstractBrushTool

#### Particles
* [ ] Fix particles not working in VR
* [ ] Use default option. When registering items,80% of the values are the same except for shaders.

#### Water
* [ ] Reduce speed in VR
* [ ] Improve plane delimiters
* [ ] Validate water plane on shake
